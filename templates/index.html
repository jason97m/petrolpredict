<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PetrolPredict - UK Fuel Price Predictions</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }
        
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
            margin-bottom: 15px;
        }
        
        .date-range {
            font-size: 1.1em;
            background: rgba(255, 255, 255, 0.2);
            padding: 12px 25px;
            border-radius: 25px;
            display: inline-block;
            margin-top: 10px;
            font-weight: 500;
        }
        
        .predictions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .country-section {
            margin-bottom: 40px;
        }
        
        .country-header {
            display: flex;
            align-items: center;
            gap: 15px;
            color: white;
            font-size: 2em;
            margin-bottom: 20px;
            font-weight: bold;
        }
        
        .flag {
            font-size: 1.5em;
        }
        
        .prediction-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .fuel-type {
            font-size: 1.5em;
            color: #667eea;
            margin-bottom: 20px;
            font-weight: bold;
        }
        
        .price-display {
            font-size: 3em;
            color: #2d3748;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .price-label {
            color: #718096;
            font-size: 0.9em;
            margin-bottom: 20px;
        }
        
        .current-price {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            background: #f7fafc;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .change {
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
        }
        
        .change.positive {
            background: #fed7d7;
            color: #c53030;
        }
        
        .change.negative {
            background: #c6f6d5;
            color: #22543d;
        }
        
        .confidence {
            margin-top: 15px;
            padding: 15px;
            background: #edf2f7;
            border-radius: 8px;
            font-size: 0.9em;
        }
        
        .info-box {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            color: #2d3748;
        }
        
        .loading {
            text-align: center;
            color: white;
            font-size: 1.5em;
        }
        
        .error {
            background: #fed7d7;
            color: #c53030;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }
        
        .meta-info {
            text-align: center;
            color: white;
            margin-top: 20px;
            font-size: 0.9em;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>â›½ PetrolPredict</h1>
            <p class="subtitle">Fuel Price Predictions for UK & US</p>
            <div class="date-range" id="date-range">Loading...</div>
        </header>
        
        <div id="content">
            <div class="loading">Loading predictions...</div>
        </div>
        
        <div class="meta-info" id="meta-info"></div>
    </div>
    
    <script>
        async function loadPredictions() {
            try {
                const response = await fetch('/api/predictions');
                const data = await response.json();
                
                if (data.error) {
                    document.getElementById('content').innerHTML = `
                        <div class="error">
                            <h3>Error Loading Predictions</h3>
                            <p>${data.error}</p>
                        </div>
                    `;
                    return;
                }
                
                displayPredictions(data);
            } catch (error) {
                document.getElementById('content').innerHTML = `
                    <div class="error">
                        <h3>Error Loading Predictions</h3>
                        <p>Unable to fetch fuel price predictions. Please try again later.</p>
                    </div>
                `;
            }
        }
        
        function displayPredictions(data) {
            // Update date range at the top
            const predictionDate = new Date(data.prediction_date);
            const weekEnd = new Date(predictionDate);
            weekEnd.setDate(weekEnd.getDate() + 6); // Add 6 days to get end of week
            
            const formatDate = (date) => {
                const options = { month: 'short', day: 'numeric', year: 'numeric' };
                return date.toLocaleDateString('en-US', options);
            };
            
            document.getElementById('date-range').innerHTML = `
                ðŸ“… Prediction Week: ${formatDate(predictionDate)} - ${formatDate(weekEnd)}
            `;
            
            let html = '';
            
            // UK Section
            if (data.uk.available && data.uk.predictions) {
                html += `
                    <div class="country-section">
                        <div class="country-header">
                            <span class="flag">ðŸ‡¬ðŸ‡§</span>
                            <span>United Kingdom</span>
                        </div>
                        <div class="predictions-grid">
                `;
                
                const ukPredictions = data.uk.predictions;
                
                // UK Unleaded
                const unleaded = ukPredictions.unleaded;
                const unleadedChange = unleaded.change >= 0 ? 'positive' : 'negative';
                const unleadedSymbol = unleaded.change >= 0 ? 'â†‘' : 'â†“';
                
                html += `
                    <div class="prediction-card">
                        <div class="fuel-type">Unleaded Petrol</div>
                        <div class="price-display">${unleaded.predicted_price}p</div>
                        <div class="price-label">Predicted price per litre</div>
                        
                        <div class="current-price">
                            <span>Current Price:</span>
                            <strong>${unleaded.current_price}p</strong>
                        </div>
                        
                        <div class="change ${unleadedChange}">
                            ${unleadedSymbol} ${Math.abs(unleaded.change)}p change expected
                        </div>
                        
                        <div class="confidence">
                            <strong>Confidence Range:</strong><br>
                            ${unleaded.confidence_lower}p - ${unleaded.confidence_upper}p
                        </div>
                    </div>
                `;
                
                // UK Diesel
                const ukDiesel = ukPredictions.diesel;
                const ukDieselChange = ukDiesel.change >= 0 ? 'positive' : 'negative';
                const ukDieselSymbol = ukDiesel.change >= 0 ? 'â†‘' : 'â†“';
                
                html += `
                    <div class="prediction-card">
                        <div class="fuel-type">Diesel</div>
                        <div class="price-display">${ukDiesel.predicted_price}p</div>
                        <div class="price-label">Predicted price per litre</div>
                        
                        <div class="current-price">
                            <span>Current Price:</span>
                            <strong>${ukDiesel.current_price}p</strong>
                        </div>
                        
                        <div class="change ${ukDieselChange}">
                            ${ukDieselSymbol} ${Math.abs(ukDiesel.change)}p change expected
                        </div>
                        
                        <div class="confidence">
                            <strong>Confidence Range:</strong><br>
                            ${ukDiesel.confidence_lower}p - ${ukDiesel.confidence_upper}p
                        </div>
                    </div>
                `;
                
                html += `
                        </div>
                    </div>
                `;
            }
            
            // US Section
            if (data.us.available && data.us.predictions) {
                html += `
                    <div class="country-section">
                        <div class="country-header">
                            <span class="flag">ðŸ‡ºðŸ‡¸</span>
                            <span>United States</span>
                        </div>
                        <div class="predictions-grid">
                `;
                
                const usPredictions = data.us.predictions;
                
                // US Regular
                const regular = usPredictions.regular;
                const regularChange = regular.change >= 0 ? 'positive' : 'negative';
                const regularSymbol = regular.change >= 0 ? 'â†‘' : 'â†“';
                
                html += `
                    <div class="prediction-card">
                        <div class="fuel-type">Regular Gasoline</div>
                        <div class="price-display">${regular.predicted_price}Â¢</div>
                        <div class="price-label">Predicted price per gallon</div>
                        
                        <div class="current-price">
                            <span>Current Price:</span>
                            <strong>${regular.current_price}Â¢</strong>
                        </div>
                        
                        <div class="change ${regularChange}">
                            ${regularSymbol} ${Math.abs(regular.change)}Â¢ change expected
                        </div>
                        
                        <div class="confidence">
                            <strong>Confidence Range:</strong><br>
                            ${regular.confidence_lower}Â¢ - ${regular.confidence_upper}Â¢
                        </div>
                    </div>
                `;
                
                // US Diesel
                const usDiesel = usPredictions.diesel;
                const usDieselChange = usDiesel.change >= 0 ? 'positive' : 'negative';
                const usDieselSymbol = usDiesel.change >= 0 ? 'â†‘' : 'â†“';
                
                html += `
                    <div class="prediction-card">
                        <div class="fuel-type">Diesel</div>
                        <div class="price-display">${usDiesel.predicted_price}Â¢</div>
                        <div class="price-label">Predicted price per gallon</div>
                        
                        <div class="current-price">
                            <span>Current Price:</span>
                            <strong>${usDiesel.current_price}Â¢</strong>
                        </div>
                        
                        <div class="change ${usDieselChange}">
                            ${usDieselSymbol} ${Math.abs(usDiesel.change)}Â¢ change expected
                        </div>
                        
                        <div class="confidence">
                            <strong>Confidence Range:</strong><br>
                            ${usDiesel.confidence_lower}Â¢ - ${usDiesel.confidence_upper}Â¢
                        </div>
                    </div>
                `;
                
                html += `
                        </div>
                    </div>
                `;
            }
            
            // Add info box
            html += `
                <div class="info-box">
                    <h3 style="margin-bottom: 15px;">About These Predictions</h3>
                    <p>These predictions are based on historical fuel price data using a moving average and trend analysis. 
                    UK prices are shown in pence per litre, US prices in cents per gallon. 
                    Predictions are for guidance only and actual prices may vary based on market conditions, 
                    global oil prices, and other factors.</p>
                </div>
            `;
            
            document.getElementById('content').innerHTML = html;
            
            document.getElementById('meta-info').innerHTML = `
                Last updated: ${data.last_updated} | Prediction for: ${data.prediction_date}
            `;
        }
        
        // Load predictions on page load
        loadPredictions();
    </script>
</body>
</html>
